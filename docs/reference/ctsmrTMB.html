<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="Call ctsmrTMB$new() to construct a new instance of the class object
for specifying a new stochastic state space model."><title>Constructor for R6 ctsmrTMB class — ctsmrTMB • ctsmrTMB</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><link href="../deps/Mukta-0.4.2/font.css" rel="stylesheet"><link href="../deps/Source_Code_Pro-0.4.2/font.css" rel="stylesheet"><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Constructor for R6 ctsmrTMB class — ctsmrTMB"><meta property="og:description" content="Call ctsmrTMB$new() to construct a new instance of the class object
for specifying a new stochastic state space model."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-dark"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">ctsmrTMB</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.5</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item">
  <a class="nav-link" href="../articles/ctsmrTMB.html">Get started</a>
</li>
<li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/construct_nll.html">construct_nll: How to extract function handlers, and choosing your own optimizer</a>
    <a class="dropdown-item" href="../articles/estimate.html">estimate: Estimating model parameters and states</a>
    <a class="dropdown-item" href="../articles/observation_equations.html">observations: Using functions on the left-hand side</a>
    <a class="dropdown-item" href="../articles/predict.html">predict: Forecasting the model states and observations.</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/phillipbvetter/ctsmrTMB/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Constructor for R6 ctsmrTMB class</h1>
      <small class="dont-index">Source: <a href="https://github.com/phillipbvetter/ctsmrTMB/blob/HEAD/R/ctsmrTMB.R" class="external-link"><code>R/ctsmrTMB.R</code></a></small>
      <div class="d-none name"><code>ctsmrTMB.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Call ctsmrTMB$new() to construct a new instance of the class object
for specifying a new stochastic state space model.</p>
    </div>


    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>A model object of class 'ctsmrTMB'</p>
    </div>
    <div class="section level2">
    <h2 id="methods">Methods<a class="anchor" aria-label="anchor" href="#methods"></a></h2>
    
<div class="section">
<h3 id="public-methods">Public methods<a class="anchor" aria-label="anchor" href="#public-methods"></a></h3>

<ul><li><p><a href="#method-ctsmrTMB-new"><code>ctsmrTMB$new()</code></a></p></li>
<li><p><a href="#method-ctsmrTMB-add_systems"><code>ctsmrTMB$add_systems()</code></a></p></li>
<li><p><a href="#method-ctsmrTMB-add_observations"><code>ctsmrTMB$add_observations()</code></a></p></li>
<li><p><a href="#method-ctsmrTMB-add_observation_variances"><code>ctsmrTMB$add_observation_variances()</code></a></p></li>
<li><p><a href="#method-ctsmrTMB-add_inputs"><code>ctsmrTMB$add_inputs()</code></a></p></li>
<li><p><a href="#method-ctsmrTMB-add_parameters"><code>ctsmrTMB$add_parameters()</code></a></p></li>
<li><p><a href="#method-ctsmrTMB-add_algebraics"><code>ctsmrTMB$add_algebraics()</code></a></p></li>
<li><p><a href="#method-ctsmrTMB-add_constants"><code>ctsmrTMB$add_constants()</code></a></p></li>
<li><p><a href="#method-ctsmrTMB-set_initial_state"><code>ctsmrTMB$set_initial_state()</code></a></p></li>
<li><p><a href="#method-ctsmrTMB-set_lamperti"><code>ctsmrTMB$set_lamperti()</code></a></p></li>
<li><p><a href="#method-ctsmrTMB-set_modelname"><code>ctsmrTMB$set_modelname()</code></a></p></li>
<li><p><a href="#method-ctsmrTMB-set_cppfile_directory"><code>ctsmrTMB$set_cppfile_directory()</code></a></p></li>
<li><p><a href="#method-ctsmrTMB-set_map"><code>ctsmrTMB$set_map()</code></a></p></li>
<li><p><a href="#method-ctsmrTMB-get_systems"><code>ctsmrTMB$get_systems()</code></a></p></li>
<li><p><a href="#method-ctsmrTMB-get_observations"><code>ctsmrTMB$get_observations()</code></a></p></li>
<li><p><a href="#method-ctsmrTMB-get_observation_variances"><code>ctsmrTMB$get_observation_variances()</code></a></p></li>
<li><p><a href="#method-ctsmrTMB-get_algebraics"><code>ctsmrTMB$get_algebraics()</code></a></p></li>
<li><p><a href="#method-ctsmrTMB-get_parameters"><code>ctsmrTMB$get_parameters()</code></a></p></li>
<li><p><a href="#method-ctsmrTMB-construct_nll"><code>ctsmrTMB$construct_nll()</code></a></p></li>
<li><p><a href="#method-ctsmrTMB-estimate"><code>ctsmrTMB$estimate()</code></a></p></li>
<li><p><a href="#method-ctsmrTMB-predict"><code>ctsmrTMB$predict()</code></a></p></li>
<li><p><a href="#method-ctsmrTMB-print"><code>ctsmrTMB$print()</code></a></p></li>
<li><p><a href="#method-ctsmrTMB-summary"><code>ctsmrTMB$summary()</code></a></p></li>
<li><p><a href="#method-ctsmrTMB-plot"><code>ctsmrTMB$plot()</code></a></p></li>
<li><p><a href="#method-ctsmrTMB-clone"><code>ctsmrTMB$clone()</code></a></p></li>
</ul></div><p></p><hr><a id="method-ctsmrTMB-new"></a><div class="section">
<h3 id="method-new-">Method <code>new()</code><a class="anchor" aria-label="anchor" href="#method-new-"></a></h3>
<p>Construct a new ctsmrTMB model object.</p><div class="section">
<h4 id="usage">Usage<a class="anchor" aria-label="anchor" href="#usage"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va"><a href="../reference/ctsmrTMB.html">ctsmrTMB</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>


</div><p></p><hr><a id="method-ctsmrTMB-add_systems"></a><div class="section">
<h3 id="method-add-systems-">Method <code>add_systems()</code><a class="anchor" aria-label="anchor" href="#method-add-systems-"></a></h3>
<p>Define and add multiple stochastic differential equation governing the process of individual state variables
on the form</p>
<p><code>d&lt;state&gt; ~ f(t,&lt;states&gt;,&lt;inputs&gt;) * dt + g1(t,&lt;states&gt;,&lt;inputs&gt;) * dw1 
                                         + g2(t,&lt;states&gt;,&lt;inputs&gt;) * dw2 
                                           + ...</code></p>
<p>where <code>f</code> is the drift, and <code>g1, g2, ...</code> are diffusions, with differential brownian motions dw1, dw2, ...</p><div class="section">
<h4 id="usage-1">Usage<a class="anchor" aria-label="anchor" href="#usage-1"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va">ctsmrTMB</span><span class="op">$</span><span class="fu">add_systems</span><span class="op">(</span><span class="va">form</span>, <span class="va">...</span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>

<div class="section">
<h4 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h4>
<p></p><div class="arguments"><dl><dt><code>form</code></dt>
<dd><p>formula specifying the stochastic differential equation to be added to the system.</p></dd>


<dt><code>...</code></dt>
<dd><p>additional formulas similar to <code>form</code> for specifying multiple equations at once.</p></dd>


</dl><p></p></div>
</div>
<div class="section">
<h4 id="examples">Examples<a class="anchor" aria-label="anchor" href="#examples"></a></h4>
<p></p><div class="r example copy"><div class="sourceCode"><pre><code><span><span class="co"># Specify Ornstein-Uhlenbeck Process</span></span>
<span><span class="fu">add_systems</span><span class="op">(</span><span class="va">dX</span> <span class="op">~</span> <span class="va">theta</span> <span class="op">*</span> <span class="op">(</span><span class="va">mu</span> <span class="op">-</span> <span class="va">X</span> <span class="op">+</span> <span class="va">u</span><span class="op">)</span> <span class="op">*</span> <span class="va">dt</span> <span class="op">+</span> <span class="va">sigma</span> <span class="op">*</span> <span class="va">dw</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Specify Lokta-Volterra System of Equations</span></span>
<span><span class="fu">add_systems</span><span class="op">(</span> <span class="va">dN</span> <span class="op">~</span> <span class="op">(</span> <span class="va">r</span> <span class="op">*</span> <span class="va">N</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">N</span><span class="op">/</span><span class="va">K</span><span class="op">)</span> <span class="op">-</span> <span class="va">c</span><span class="op">*</span><span class="va">N</span><span class="op">*</span><span class="va">P</span><span class="op">/</span><span class="op">(</span><span class="va">N</span><span class="op">+</span><span class="va">Nbar</span><span class="op">)</span> <span class="op">)</span> <span class="op">*</span> <span class="va">dt</span> <span class="op">+</span> <span class="va">sigmaN</span> <span class="op">*</span> <span class="va">N</span> <span class="op">*</span> <span class="va">dw1</span>,</span>
<span>             <span class="va">dP</span> <span class="op">~</span> <span class="op">(</span> <span class="va">eps</span><span class="op">*</span><span class="va">c</span><span class="op">*</span><span class="va">N</span><span class="op">*</span><span class="va">P</span><span class="op">/</span><span class="op">(</span><span class="va">N</span><span class="op">+</span><span class="va">Nbar</span><span class="op">)</span> <span class="op">-</span> <span class="va">mu</span> <span class="op">*</span> <span class="va">P</span> <span class="op">)</span> <span class="op">*</span> <span class="va">dt</span> <span class="op">+</span> <span class="va">sigmaP</span> <span class="op">*</span> <span class="va">P</span> <span class="op">*</span> <span class="va">dw2</span> <span class="op">)</span></span></code></pre></div><p></p></div>
</div>


</div><p></p><hr><a id="method-ctsmrTMB-add_observations"></a><div class="section">
<h3 id="method-add-observations-">Method <code>add_observations()</code><a class="anchor" aria-label="anchor" href="#method-add-observations-"></a></h3>
<p>Define and add a relationship between an observed variable and system states. The observation equation
takes the form</p>
<p><code>&lt;observation&gt; ~ h(t,&lt;states&gt;,&lt;inputs&gt;) + e)</code></p>
<p>where <code>h</code> is the observation function, and <code>e</code> is normally distributed noise with zero mean and variance
to be specified. The observation variable should be present in the data provided when calling
<code>estimate(.data)</code> for parameter estimation.</p><div class="section">
<h4 id="usage-2">Usage<a class="anchor" aria-label="anchor" href="#usage-2"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va">ctsmrTMB</span><span class="op">$</span><span class="fu">add_observations</span><span class="op">(</span><span class="va">form</span>, <span class="va">...</span>, obsnames <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>

<div class="section">
<h4 id="arguments-1">Arguments<a class="anchor" aria-label="anchor" href="#arguments-1"></a></h4>
<p></p><div class="arguments"><dl><dt><code>form</code></dt>
<dd><p>formula class specifying the obsevation equation to be added to the system.</p></dd>


<dt><code>...</code></dt>
<dd><p>additional formulas identical to <code>form</code> to specify multiple observation equations at a time.</p></dd>


<dt><code>obsnames</code></dt>
<dd><p>character vector specifying the name of the observation. When the observation left-hand side
consists of more than just a single variable name (when its class is 'call' instead of 'name') it will be
given a name on the form obs__# where # is a number, unless obsnames is provided.</p></dd>


</dl><p></p></div>
</div>
<div class="section">
<h4 id="examples-1">Examples<a class="anchor" aria-label="anchor" href="#examples-1"></a></h4>
<p></p><div class="r example copy"><div class="sourceCode"><pre><code>#Specify observation directly as a latent state
add_observations(y ~ x)

Specify observation as the sum of exponentials of two latent states
add_observations(y ~ exp(x1) + exp(x2))
</code></pre></div><p></p></div>
</div>


</div><p></p><hr><a id="method-ctsmrTMB-add_observation_variances"></a><div class="section">
<h3 id="method-add-observation-variances-">Method <code>add_observation_variances()</code><a class="anchor" aria-label="anchor" href="#method-add-observation-variances-"></a></h3>
<p>Specify the variance of an observation equation.</p>
<p>A defined observation variable <code>y</code> in e.g. <code>add_observations(y ~ 
h(t,&lt;states&gt;,&lt;inputs&gt;)</code> is pertubed by Gaussian noise with zero mean and variance
to-be specified using <code>add_observation_variances(y ~ p(t,&lt;states&gt;,&lt;inputs&gt;)</code>. We can
for instance declare <code>add_observation_variances(y ~ sigma_x^2</code> where <code>sigma_x</code>
is a fixed effect parameter to be declared through <code>add_parameters</code>.</p><div class="section">
<h4 id="usage-3">Usage<a class="anchor" aria-label="anchor" href="#usage-3"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va">ctsmrTMB</span><span class="op">$</span><span class="fu">add_observation_variances</span><span class="op">(</span><span class="va">form</span>, <span class="va">...</span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>

<div class="section">
<h4 id="arguments-2">Arguments<a class="anchor" aria-label="anchor" href="#arguments-2"></a></h4>
<p></p><div class="arguments"><dl><dt><code>form</code></dt>
<dd><p>formula class specifying the obsevation equation to be added to the system.</p></dd>


<dt><code>...</code></dt>
<dd><p>additional formulas identical to <code>form</code> to specify multiple observation equations at a time.</p></dd>


</dl><p></p></div>
</div>

</div><p></p><hr><a id="method-ctsmrTMB-add_inputs"></a><div class="section">
<h3 id="method-add-inputs-">Method <code>add_inputs()</code><a class="anchor" aria-label="anchor" href="#method-add-inputs-"></a></h3>
<p>Declare variables as data inputs</p>
<p>Declare whether a variable contained in system, observation or observation variance equations
is an input variable. If e.g. the system equation contains an input variable <code>u</code> then it
is declared using <code>add_inputs(u)</code>. The input <code>u</code> must be contained in the
data.frame <code>.data</code> provided when calling the <code>estimate</code> or <code>predict</code> methods.</p><div class="section">
<h4 id="usage-4">Usage<a class="anchor" aria-label="anchor" href="#usage-4"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va">ctsmrTMB</span><span class="op">$</span><span class="fu">add_inputs</span><span class="op">(</span><span class="va">...</span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>

<div class="section">
<h4 id="arguments-3">Arguments<a class="anchor" aria-label="anchor" href="#arguments-3"></a></h4>
<p></p><div class="arguments"><dl><dt><code>...</code></dt>
<dd><p>unquoted variable names that specifies the name of input variables in the defined system.</p></dd>


</dl><p></p></div>
</div>

</div><p></p><hr><a id="method-ctsmrTMB-add_parameters"></a><div class="section">
<h3 id="method-add-parameters-">Method <code>add_parameters()</code><a class="anchor" aria-label="anchor" href="#method-add-parameters-"></a></h3>
<p>Declare variables as fixed effects and specify their initial value, lower and
upper bound used when calling the maximum likelihood optimization.</p>
<p>There are two ways to declare parameters. You can declare parameters using formulas i.e.
<code>add_parameters( theta ~ c(1,0,10), mu ~ c(0,-10,10) )</code>, where the values are initial,
lower and upper bound respectively. Alternatively you can provide a 3-column matrix where
rows corresponds to different parameters, and the parameter names are provided as rownames
of the matrix.</p><div class="section">
<h4 id="usage-5">Usage<a class="anchor" aria-label="anchor" href="#usage-5"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va">ctsmrTMB</span><span class="op">$</span><span class="fu">add_parameters</span><span class="op">(</span><span class="va">...</span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>

<div class="section">
<h4 id="arguments-4">Arguments<a class="anchor" aria-label="anchor" href="#arguments-4"></a></h4>
<p></p><div class="arguments"><dl><dt><code>...</code></dt>
<dd><p>formula whose left-hand side is the parameter name, and right hand side is a vector
of length 3 with inital value, lower and upper bound respectively. You can provide multiple
parameters at once by seperating formulas with comma.</p></dd>


<dt><code>parameter.matrix</code></dt>
<dd><p>matrix of 3 columns where rows correspond to variables. The variable
names must be provided as rownames to the matrix. The columns are initial value, lower and
upper bound respectively.</p></dd>


</dl><p></p></div>
</div>

</div><p></p><hr><a id="method-ctsmrTMB-add_algebraics"></a><div class="section">
<h3 id="method-add-algebraics-">Method <code>add_algebraics()</code><a class="anchor" aria-label="anchor" href="#method-add-algebraics-"></a></h3>
<p>Add algebraic relations.</p>
<p>Algebraic relations is a convenient way to transform parameters in your equations.
In the Ornstein-Uhlenbeck process the rate parameter <code>theta</code> is always positive, so
estimation in the log-domain is a good idea. Instead of writing <code>exp(theta)</code> directly
in the system equation one can transform into the log domain using the algebraic relation
<code>add_algebraics(theta ~ exp(logtheta))</code>. All instances of <code>theta</code> is replaced
by <code>exp(logtheta)</code> when compiling the C++ function. Note that you must provide values
for <code>logtheta</code> now instead of <code>theta</code> when declaring parameters through
<code>add_parameters</code></p><div class="section">
<h4 id="usage-6">Usage<a class="anchor" aria-label="anchor" href="#usage-6"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va">ctsmrTMB</span><span class="op">$</span><span class="fu">add_algebraics</span><span class="op">(</span><span class="va">form</span>, <span class="va">...</span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>

<div class="section">
<h4 id="arguments-5">Arguments<a class="anchor" aria-label="anchor" href="#arguments-5"></a></h4>
<p></p><div class="arguments"><dl><dt><code>form</code></dt>
<dd><p>formula specifying the stochastic differential equation(s) to be added to the system.</p></dd>


<dt><code>...</code></dt>
<dd><p>additional formulas similar to <code>form</code> for specifying multiple equations at once.</p></dd>


</dl><p></p></div>
</div>

</div><p></p><hr><a id="method-ctsmrTMB-add_constants"></a><div class="section">
<h3 id="method-add-constants-">Method <code>add_constants()</code><a class="anchor" aria-label="anchor" href="#method-add-constants-"></a></h3>
<p>Declare variables as scalar constants.</p><div class="section">
<h4 id="usage-7">Usage<a class="anchor" aria-label="anchor" href="#usage-7"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va">ctsmrTMB</span><span class="op">$</span><span class="fu">add_constants</span><span class="op">(</span><span class="va">...</span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>

<div class="section">
<h4 id="arguments-6">Arguments<a class="anchor" aria-label="anchor" href="#arguments-6"></a></h4>
<p></p><div class="arguments"><dl><dt><code>...</code></dt>
<dd><p>additional formulas similar to <code>form</code> for specifying multiple constants at once.</p></dd>


<dt><code>form</code></dt>
<dd><p>formula whose left-hand side is the constant variable name, and the right-hand side
is its numeric value.</p></dd>


</dl><p></p></div>
</div>

</div><p></p><hr><a id="method-ctsmrTMB-set_initial_state"></a><div class="section">
<h3 id="method-set-initial-state-">Method <code>set_initial_state()</code><a class="anchor" aria-label="anchor" href="#method-set-initial-state-"></a></h3>
<p>Declare the initial state values i.e. mean and covariance for the system states.</p><div class="section">
<h4 id="usage-8">Usage<a class="anchor" aria-label="anchor" href="#usage-8"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va">ctsmrTMB</span><span class="op">$</span><span class="fu">set_initial_state</span><span class="op">(</span><span class="va">mean</span>, <span class="va">cov</span>, estimate <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>

<div class="section">
<h4 id="arguments-7">Arguments<a class="anchor" aria-label="anchor" href="#arguments-7"></a></h4>
<p></p><div class="arguments"><dl><dt><code>mean</code></dt>
<dd><p>numeric vector of size equal to <code>n</code> (number of system states)</p></dd>


<dt><code>cov</code></dt>
<dd><p>matrix (symmetric positive semi-definite) of dimensions <code>n^2</code>.</p></dd>


<dt><code>estimate</code></dt>
<dd><p>boolean value which indicates whether or not the initial conditions
shall be estimated as fixed effects parameters. The provided mean and covariance are then
used as initial guesses</p></dd>


</dl><p></p></div>
</div>

</div><p></p><hr><a id="method-ctsmrTMB-set_lamperti"></a><div class="section">
<h3 id="method-set-lamperti-">Method <code>set_lamperti()</code><a class="anchor" aria-label="anchor" href="#method-set-lamperti-"></a></h3>
<p>Set a Lamperti Transformation</p>
<p>If the provided system equations have state dependent diffusion in of a few available ways
then it is advantageous to perform a transformation to remove the state dependence. This
comes at the cost of a more complicated drift function. The following types of state-dependence
is currently supported</p><ol><li><p>If no transformation is desired choose 'identity' (default).</p></li>
<li><p>If the diffusion term is proportional to x * dw, then a log-transform is available</p></li>
<li><p>If the diffusion term is proportional to x * (1-x) * dw, then a logit-transform is available</p></li>
<li><p>If the diffusion term is proportional to sqrt(x * (1-x)) * dw, then a sqrt-logit-transform
is available</p></li>
<li><p>If the diffusion term is proportional to x * (1-x^a) * dw, for a&gt;0 then a power-logit
transform is available</p></li>
</ol><div class="section">
<h4 id="usage-9">Usage<a class="anchor" aria-label="anchor" href="#usage-9"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va">ctsmrTMB</span><span class="op">$</span><span class="fu">set_lamperti</span><span class="op">(</span><span class="va">transform</span>, states <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>

<div class="section">
<h4 id="arguments-8">Arguments<a class="anchor" aria-label="anchor" href="#arguments-8"></a></h4>
<p></p><div class="arguments"><dl><dt><code>transform</code></dt>
<dd><p>character vector - one of either "identity, "log", "logit", "sqrt-logit", or "power-logit"</p></dd>


<dt><code>states</code></dt>
<dd><p>a vector of the state names for which the chosen transformation is desired. The
default (NULL) is to apply the transformation to all state equations.</p></dd>


</dl><p></p></div>
</div>

</div><p></p><hr><a id="method-ctsmrTMB-set_modelname"></a><div class="section">
<h3 id="method-set-modelname-">Method <code>set_modelname()</code><a class="anchor" aria-label="anchor" href="#method-set-modelname-"></a></h3>
<p>Set modelname used to create the C++ file for TMB</p>
<p>When calling <code><a href="https://rdrr.io/pkg/TMB/man/MakeADFun.html" class="external-link">TMB::MakeADFun</a></code> the (negative log) likelihood function is created in the
directory specified by the <code>set_cppfile_directory</code> method with name <code>&lt;modelname&gt;.cpp</code></p><div class="section">
<h4 id="usage-10">Usage<a class="anchor" aria-label="anchor" href="#usage-10"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va">ctsmrTMB</span><span class="op">$</span><span class="fu">set_modelname</span><span class="op">(</span><span class="va">name</span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>

<div class="section">
<h4 id="arguments-9">Arguments<a class="anchor" aria-label="anchor" href="#arguments-9"></a></h4>
<p></p><div class="arguments"><dl><dt><code>name</code></dt>
<dd><p>string defining the model name.</p></dd>


</dl><p></p></div>
</div>

</div><p></p><hr><a id="method-ctsmrTMB-set_cppfile_directory"></a><div class="section">
<h3 id="method-set-cppfile-directory-">Method <code>set_cppfile_directory()</code><a class="anchor" aria-label="anchor" href="#method-set-cppfile-directory-"></a></h3>
<p>Set the path directory where the constructed C++ file is created.
You should specify the entire path, unless you want to construct a subfolder
in the current working directory - then you can call e.g. <code>set_cppfile_directory("folder_in_current_wd")</code>.</p><div class="section">
<h4 id="usage-11">Usage<a class="anchor" aria-label="anchor" href="#usage-11"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va">ctsmrTMB</span><span class="op">$</span><span class="fu">set_cppfile_directory</span><span class="op">(</span><span class="va">directory</span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>

<div class="section">
<h4 id="arguments-10">Arguments<a class="anchor" aria-label="anchor" href="#arguments-10"></a></h4>
<p></p><div class="arguments"><dl><dt><code>directory</code></dt>
<dd><p>string specifying a local directory</p></dd>


</dl><p></p></div>
</div>

</div><p></p><hr><a id="method-ctsmrTMB-set_map"></a><div class="section">
<h3 id="method-set-map-">Method <code>set_map()</code><a class="anchor" aria-label="anchor" href="#method-set-map-"></a></h3>
<p>Enable maximum a posterior (MAP) estimation.</p>
<p>Adds a maximum a posterior contribution to the (negative log) likelihood
function by evaluating the fixed effects parameters in a multivariate Gaussian
with <code>mean</code> and <code>covariance</code> as provided.</p><div class="section">
<h4 id="usage-12">Usage<a class="anchor" aria-label="anchor" href="#usage-12"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va">ctsmrTMB</span><span class="op">$</span><span class="fu">set_map</span><span class="op">(</span><span class="va">mean</span>, <span class="va">cov</span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>

<div class="section">
<h4 id="arguments-11">Arguments<a class="anchor" aria-label="anchor" href="#arguments-11"></a></h4>
<p></p><div class="arguments"><dl><dt><code>mean</code></dt>
<dd><p>mean vector of the Gaussian prior parameter distribution</p></dd>


<dt><code>cov</code></dt>
<dd><p>covariance matrix of the Gaussian prior parameter distribution</p></dd>


</dl><p></p></div>
</div>

</div><p></p><hr><a id="method-ctsmrTMB-get_systems"></a><div class="section">
<h3 id="method-get-systems-">Method <code>get_systems()</code><a class="anchor" aria-label="anchor" href="#method-get-systems-"></a></h3>
<p>Retrieve system equations.</p><div class="section">
<h4 id="usage-13">Usage<a class="anchor" aria-label="anchor" href="#usage-13"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va">ctsmrTMB</span><span class="op">$</span><span class="fu">get_systems</span><span class="op">(</span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>


</div><p></p><hr><a id="method-ctsmrTMB-get_observations"></a><div class="section">
<h3 id="method-get-observations-">Method <code>get_observations()</code><a class="anchor" aria-label="anchor" href="#method-get-observations-"></a></h3>
<p>Retrieve observation equations.</p><div class="section">
<h4 id="usage-14">Usage<a class="anchor" aria-label="anchor" href="#usage-14"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va">ctsmrTMB</span><span class="op">$</span><span class="fu">get_observations</span><span class="op">(</span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>


</div><p></p><hr><a id="method-ctsmrTMB-get_observation_variances"></a><div class="section">
<h3 id="method-get-observation-variances-">Method <code>get_observation_variances()</code><a class="anchor" aria-label="anchor" href="#method-get-observation-variances-"></a></h3>
<p>Retrieve observation variances</p><div class="section">
<h4 id="usage-15">Usage<a class="anchor" aria-label="anchor" href="#usage-15"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va">ctsmrTMB</span><span class="op">$</span><span class="fu">get_observation_variances</span><span class="op">(</span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>


</div><p></p><hr><a id="method-ctsmrTMB-get_algebraics"></a><div class="section">
<h3 id="method-get-algebraics-">Method <code>get_algebraics()</code><a class="anchor" aria-label="anchor" href="#method-get-algebraics-"></a></h3>
<p>Retrieve algebraic relations</p><div class="section">
<h4 id="usage-16">Usage<a class="anchor" aria-label="anchor" href="#usage-16"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va">ctsmrTMB</span><span class="op">$</span><span class="fu">get_algebraics</span><span class="op">(</span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>


</div><p></p><hr><a id="method-ctsmrTMB-get_parameters"></a><div class="section">
<h3 id="method-get-parameters-">Method <code>get_parameters()</code><a class="anchor" aria-label="anchor" href="#method-get-parameters-"></a></h3>
<p>Get initial (and estimated) parameters.</p><div class="section">
<h4 id="usage-17">Usage<a class="anchor" aria-label="anchor" href="#usage-17"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va">ctsmrTMB</span><span class="op">$</span><span class="fu">get_parameters</span><span class="op">(</span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>


</div><p></p><hr><a id="method-ctsmrTMB-construct_nll"></a><div class="section">
<h3 id="method-construct-nll-">Method <code>construct_nll()</code><a class="anchor" aria-label="anchor" href="#method-construct-nll-"></a></h3>
<p>Construct and extract function handlers for the negative
log likelihood function.</p>
<p>The handlers from <code>TMB</code>'s <code>MakeADFun</code> are constructed and returned.
This enables the user to e.g. determine their own optimization algorithm to use
for estimation.</p><div class="section">
<h4 id="usage-18">Usage<a class="anchor" aria-label="anchor" href="#usage-18"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va">ctsmrTMB</span><span class="op">$</span><span class="fu">construct_nll</span><span class="op">(</span></span>
<span>  <span class="va">data</span>,</span>
<span>  method <span class="op">=</span> <span class="st">"ekf"</span>,</span>
<span>  ode.solver <span class="op">=</span> <span class="st">"euler"</span>,</span>
<span>  ode.timestep <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/diff.html" class="external-link">diff</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">t</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  loss <span class="op">=</span> <span class="st">"quadratic"</span>,</span>
<span>  loss_c <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  compile <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>

<div class="section">
<h4 id="arguments-12">Arguments<a class="anchor" aria-label="anchor" href="#arguments-12"></a></h4>
<p></p><div class="arguments"><dl><dt><code>data</code></dt>
<dd><p>data.frame containing time-vector 't', observations and inputs. The observations
can take <code>NA</code>-values.</p></dd>


<dt><code>method</code></dt>
<dd><p>character vector - one of either "ekf", "ukf" or "tmb". Sets the estimation
method. The package has three available methods implemented:</p><ol><li><p>The natural TMB-style formulation where latent states are considered random effects
and are integrated out using the Laplace approximation. This method only yields the gradient
of the (negative log) likelihood function with respect to the fixed effects for optimization.
The method is slower although probably has some precision advantages, and allows for non-Gaussian
observation noise (not yet implemented). One-step / K-step residuals are not yet available in
the package.</p></li>
<li><p>(Continous-Discrete) Extended Kalman Filter where the system dynamics are linearized
to handle potential non-linearities. This is computationally the fastest method.</p></li>
<li><p>(Continous-Discrete) Unscented Kalman Filter. This is a higher order non-linear Kalman Filter
which improves the mean and covariance estimates when the system display high nonlinearity, and
circumvents the necessity to compute the jacobian of the drift and observation functions.</p></li>
</ol><p>All package features are currently available for the kalman filters, while TMB is limited to
parameter estimation. In particular, it is straight-forward to obtain k-step-ahead predictions
with these methods (use the <code>predict</code> S3 method), and stochastic simulation is also available
in the cases where long prediction horizons are sought, where the normality assumption will be
inaccurate.</p></dd>


<dt><code>ode.solver</code></dt>
<dd><p>Sets the ODE solver used in the Kalman Filter methods for solving the moment
differential equations. The default "euler" is the Forward Euler method, alternatively the classical
4th order Runge Kutta method is available via "rk4".</p></dd>


<dt><code>ode.timestep</code></dt>
<dd><p>numeric value. Sets the time step-size in numerical filtering schemes.
The defined step-size is used to calculate the number of steps between observation time-points as
defined by the provided <code>data</code>. If the calculated number of steps is larger than N.01 where N
is an integer, then the time-step is reduced such that exactly N+1 steps is taken between observations
The step-size is used in the two following ways depending on the
chosen method:</p><ol><li><p>Kalman filters: The time-step is used as the step-size in the
numerical Forward-Euler scheme to compute the prior state mean and
covariance estimate as the final time solution to the first and second
order moment differential equations.</p></li>
<li><p>TMB method: The time-step is used as the step-size in the Euler-Maruyama
scheme for simulating a sample path of the stochastic differential equation,
which serves to link together the latent (random effects) states.</p></li>
</ol></dd>


<dt><code>loss</code></dt>
<dd><p>character vector. Sets the loss function type (only implemented for the kalman filter
methods). The loss function is per default quadratic in the one-step residauls as is natural
when the Gaussian (negative log) likelihood is evaluated, but if the tails of the
distribution is considered too small i.e. outliers are weighted too much, then one
can choose loss functions that accounts for this. The three available types available:</p><ol><li><p>Quadratic loss (<code>quadratic</code>).</p></li>
<li><p>Quadratic-Linear (<code>huber</code>)</p></li>
<li><p>Quadratic-Constant (<code>tukey</code>)</p></li>
</ol><p>The cutoff for the Huber and Tukey loss functions are determined from a provided cutoff
parameter <code>loss_c</code>. The implementations of these losses are approximations (pseudo-huber and sigmoid
approxmation respectively) for smooth derivatives.</p></dd>


<dt><code>loss_c</code></dt>
<dd><p>cutoff value for huber and tukey loss functions. Defaults to <code>c=3</code></p></dd>


<dt><code>compile</code></dt>
<dd><p>boolean value. The default (<code>FALSE</code>) is to not compile the C++ objective
function but assume it is already compiled and corresponds to the specified model object. It is
the user's responsibility to ensure correspondence between the specified model and the precompiled
C++ object. If a precompiled C++ object is not found in the specified directory i.e.
in <code>&lt;cppfile_directory&gt;/&lt;modelname&gt;/(dll/so)</code> then the compile flag is set to <code>TRUE</code>.
If the user makes changes to system equations, observation equations, observation variances,
algebraic relations or lamperi transformations then the C++ object should be recompiled.</p></dd>


</dl><p></p></div>
</div>

</div><p></p><hr><a id="method-ctsmrTMB-estimate"></a><div class="section">
<h3 id="method-estimate-">Method <code>estimate()</code><a class="anchor" aria-label="anchor" href="#method-estimate-"></a></h3>
<p>Estimate the fixed effects parameters in the specified model.</p><div class="section">
<h4 id="usage-19">Usage<a class="anchor" aria-label="anchor" href="#usage-19"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va">ctsmrTMB</span><span class="op">$</span><span class="fu">estimate</span><span class="op">(</span></span>
<span>  <span class="va">data</span>,</span>
<span>  method <span class="op">=</span> <span class="st">"ekf"</span>,</span>
<span>  ode.solver <span class="op">=</span> <span class="st">"euler"</span>,</span>
<span>  ode.timestep <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/diff.html" class="external-link">diff</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">t</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  loss <span class="op">=</span> <span class="st">"quadratic"</span>,</span>
<span>  loss_c <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  use.hessian <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  compile <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>trace <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>

<div class="section">
<h4 id="arguments-13">Arguments<a class="anchor" aria-label="anchor" href="#arguments-13"></a></h4>
<p></p><div class="arguments"><dl><dt><code>data</code></dt>
<dd><p>data.frame containing time-vector 't', observations and inputs. The observations
can take <code>NA</code>-values.</p></dd>


<dt><code>method</code></dt>
<dd><p>character vector - one of either "ekf", "ukf" or "tmb". Sets the estimation
method. The package has three available methods implemented:</p><ol><li><p>The natural TMB-style formulation where latent states are considered random effects
and are integrated out using the Laplace approximation. This method only yields the gradient
of the (negative log) likelihood function with respect to the fixed effects for optimization.
The method is slower although probably has some precision advantages, and allows for non-Gaussian
observation noise (not yet implemented). One-step / K-step residuals are not yet available in
the package.</p></li>
<li><p>(Continous-Discrete) Extended Kalman Filter where the system dynamics are linearized
to handle potential non-linearities. This is computationally the fastest method.</p></li>
<li><p>(Continous-Discrete) Unscented Kalman Filter. This is a higher order non-linear Kalman Filter
which improves the mean and covariance estimates when the system display high nonlinearity, and
circumvents the necessity to compute the jacobian of the drift and observation functions.</p></li>
</ol><p>All package features are currently available for the kalman filters, while TMB is limited to
parameter estimation. In particular, it is straight-forward to obtain k-step-ahead predictions
with these methods (use the <code>predict</code> S3 method), and stochastic simulation is also available
in the cases where long prediction horizons are sought, where the normality assumption will be
inaccurate.</p></dd>


<dt><code>ode.solver</code></dt>
<dd><p>Sets the ODE solver used in the Kalman Filter methods for solving the moment
differential equations. The default "euler" is the Forward Euler method, alternatively the classical
4th order Runge Kutta method is available via "rk4".</p></dd>


<dt><code>ode.timestep</code></dt>
<dd><p>numeric value. Sets the time step-size in numerical filtering schemes.
The defined step-size is used to calculate the number of steps between observation time-points as
defined by the provided <code>data</code>. If the calculated number of steps is larger than N.01 where N
is an integer, then the time-step is reduced such that exactly N+1 steps is taken between observations
The step-size is used in the two following ways depending on the
chosen method:</p><ol><li><p>Kalman filters: The time-step is used as the step-size in the
numerical Forward-Euler scheme to compute the prior state mean and
covariance estimate as the final time solution to the first and second
order moment differential equations.</p></li>
<li><p>TMB method: The time-step is used as the step-size in the Euler-Maruyama
scheme for simulating a sample path of the stochastic differential equation,
which serves to link together the latent (random effects) states.</p></li>
</ol></dd>


<dt><code>loss</code></dt>
<dd><p>character vector. Sets the loss function type (only implemented for the kalman filter
methods). The loss function is per default quadratic in the one-step residauls as is natural
when the Gaussian (negative log) likelihood is evaluated, but if the tails of the
distribution is considered too small i.e. outliers are weighted too much, then one
can choose loss functions that accounts for this. The three available types available:</p><ol><li><p>Quadratic loss (<code>quadratic</code>).</p></li>
<li><p>Quadratic-Linear (<code>huber</code>)</p></li>
<li><p>Quadratic-Constant (<code>tukey</code>)</p></li>
</ol><p>The cutoff for the Huber and Tukey loss functions are determined from a provided cutoff
parameter <code>loss_c</code>. The implementations of these losses are approximations (pseudo-huber and sigmoid
approxmation respectively) for smooth derivatives.</p></dd>


<dt><code>loss_c</code></dt>
<dd><p>cutoff value for huber and tukey loss functions. Defaults to <code>c=3</code></p></dd>


<dt><code>use.hessian</code></dt>
<dd><p>boolean value. The default (<code>TRUE</code>) causes the optimization algorithm
<code><a href="https://rdrr.io/r/stats/nlminb.html" class="external-link">stats::nlminb</a></code> to use the fixed effects hessian of the (negative log) likelihood when
performing the optimization. This feature is only available for the kalman filter methods
without any random effects.</p></dd>


<dt><code>compile</code></dt>
<dd><p>boolean value. The default (<code>FALSE</code>) is to not compile the C++ objective
function but assume it is already compiled and corresponds to the specified model object. It is
the user's responsibility to ensure correspondence between the specified model and the precompiled
C++ object. If a precompiled C++ object is not found in the specified directory i.e.
in <code>&lt;cppfile_directory&gt;/&lt;modelname&gt;/(dll/so)</code> then the compile flag is set to <code>TRUE</code>.
If the user makes changes to system equations, observation equations, observation variances,
algebraic relations or lamperi transformations then the C++ object should be recompiled.</p></dd>


<dt><code>control</code></dt>
<dd><p>list of control parameters parsed to <code>nlminb</code> as its <code>control</code> argument.
See <code><a href="https://rdrr.io/r/stats/nlminb.html" class="external-link">?stats::nlminb</a></code> for more information</p></dd>


</dl><p></p></div>
</div>

</div><p></p><hr><a id="method-ctsmrTMB-predict"></a><div class="section">
<h3 id="method-predict-">Method <code><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict()</a></code><a class="anchor" aria-label="anchor" href="#method-predict-"></a></h3>
<p>Perform prediction/filtration to obtain state mean and covariance estimates. The predictions are
obtained by solving the moment equations <code>n.ahead</code> steps forward in time when using the current step posterior
state estimate as the initial condition.</p><div class="section">
<h4 id="usage-20">Usage<a class="anchor" aria-label="anchor" href="#usage-20"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va">ctsmrTMB</span><span class="op">$</span><span class="fu">predict</span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  pars <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  k.ahead <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  return.k.ahead <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  method <span class="op">=</span> <span class="st">"ekf"</span>,</span>
<span>  ode.timestep <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/diff.html" class="external-link">diff</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">t</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  ode.solver <span class="op">=</span> <span class="st">"euler"</span>,</span>
<span>  x0 <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  p0 <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  return.covariance <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  compile <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>

<div class="section">
<h4 id="arguments-14">Arguments<a class="anchor" aria-label="anchor" href="#arguments-14"></a></h4>
<p></p><div class="arguments"><dl><dt><code>data</code></dt>
<dd><p>data.frame containing time-vector 't', observations and inputs. The observations
can take <code>NA</code>-values.</p></dd>


<dt><code>pars</code></dt>
<dd><p>fixed parameter vector parsed to the objective function for prediction/filtration. The default
parameter values used are the initial parameters provided through <code>add_parameters</code>, unless the <code>estimate</code>
function has been run, then the default values will be those at the found optimum.</p></dd>


<dt><code>k.ahead</code></dt>
<dd><p>integer specifying the desired number of time-steps (as determined by the provided
data time-vector) for which predictions are made (integrating the moment ODEs forward in time without
data updates).</p></dd>


<dt><code>return.k.ahead</code></dt>
<dd><p>numeric vector of integers specifying which n.ahead predictions to that
should be returned.</p></dd>


<dt><code>method</code></dt>
<dd><p>character vector - one of either "ekf", "ukf" or "tmb". Sets the estimation
method. The package has three available methods implemented:</p>
<p>ONLY EKF IS IMPLEMENTED CURRENTLY!!</p><ol><li><p>The natural TMB-style formulation where latent states are considered random effects
and are integrated out using the Laplace approximation. This method only yields the gradient
of the (negative log) likelihood function with respect to the fixed effects for optimization.
The method is slower although probably has some precision advantages, and allows for non-Gaussian
observation noise (not yet implemented). One-step / K-step residuals are not yet available in
the package.</p></li>
<li><p>(Continous-Discrete) Extended Kalman Filter where the system dynamics are linearized
to handle potential non-linearities. This is computationally the fastest method.</p></li>
<li><p>(Continous-Discrete) Unscented Kalman Filter. This is a higher order non-linear Kalman Filter
which improves the mean and covariance estimates when the system display high nonlinearity, and
circumvents the necessity to compute the jacobian of the drift and observation functions.</p></li>
</ol><p>All package features are currently available for the kalman filters, while TMB is limited to
parameter estimation. In particular, it is straight-forward to obtain k-step-ahead predictions
with these methods (use the <code>predict</code> S3 method), and stochastic simulation is also available
in the cases where long prediction horizons are sought, where the normality assumption will be
inaccurate.</p></dd>


<dt><code>ode.timestep</code></dt>
<dd><p>numeric value. Sets the time step-size in numerical filtering schemes.
The defined step-size is used to calculate the number of steps between observation time-points as
defined by the provided <code>data</code>. If the calculated number of steps is larger than N.01 where N
is an integer, then the time-step is reduced such that exactly N+1 steps is taken between observations
The step-size is used in the two following ways depending on the
chosen method:</p><ol><li><p>Kalman filters: The time-step is used as the step-size in the
numerical Forward-Euler scheme to compute the prior state mean and
covariance estimate as the final time solution to the first and second
order moment differential equations.</p></li>
<li><p>TMB method: The time-step is used as the step-size in the Euler-Maruyama
scheme for simulating a sample path of the stochastic differential equation,
which serves to link together the latent (random effects) states.</p></li>
</ol></dd>


<dt><code>ode.solver</code></dt>
<dd><p>Sets the ODE solver used in the Kalman Filter methods for solving the moment
differential equations. The default "euler" is the Forward Euler method, alternatively the classical
4th order Runge Kutta method is available via "rk4".</p></dd>


<dt><code>x0</code></dt>
<dd><p>numeric vector containing the initial expected state values</p></dd>


<dt><code>p0</code></dt>
<dd><p>numeric matrix contianing the initial state covariances</p></dd>


<dt><code>return.covariance</code></dt>
<dd><p>booelan value to indicate whether the covariance (instead of the correlation)
should be returned.</p></dd>


<dt><code>compile</code></dt>
<dd><p>boolean value. The default (<code>FALSE</code>) is to not compile the C++ objective
function but assume it is already compiled and corresponds to the specified model object. It is
the user's responsibility to ensure correspondence between the specified model and the precompiled
C++ object. If a precompiled C++ object is not found in the specified directory i.e.
in <code>&lt;cppfile_directory&gt;/&lt;modelname&gt;/(dll/so)</code> then the compile flag is set to <code>TRUE</code>.
If the user makes changes to system equations, observation equations, observation variances,
algebraic relations or lamperi transformations then the C++ object should be recompiled.</p></dd>


</dl><p></p></div>
</div>
<div class="section">
<h4 id="returns">Returns<a class="anchor" aria-label="anchor" href="#returns"></a></h4>
<p>A data.frame that contains for each time step the posterior state estimate at that time.step (<code>k = 0</code>), and the
prior state predictions (<code>k = 1,...,n.ahead</code>). If <code>return.covariance = TRUE</code> then the state covariance/correlation
matrix is returned, otherwise only the marginal variances are returned.</p>
</div>

</div><p></p><hr><a id="method-ctsmrTMB-print"></a><div class="section">
<h3 id="method-print-">Method <code><a href="https://rdrr.io/r/base/print.html" class="external-link">print()</a></code><a class="anchor" aria-label="anchor" href="#method-print-"></a></h3>
<p>Function to print the model object</p><div class="section">
<h4 id="usage-21">Usage<a class="anchor" aria-label="anchor" href="#usage-21"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va">ctsmrTMB</span><span class="op">$</span><span class="fu">print</span><span class="op">(</span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>


</div><p></p><hr><a id="method-ctsmrTMB-summary"></a><div class="section">
<h3 id="method-summary-">Method <code><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary()</a></code><a class="anchor" aria-label="anchor" href="#method-summary-"></a></h3>
<p>Summary function for fit</p><div class="section">
<h4 id="usage-22">Usage<a class="anchor" aria-label="anchor" href="#usage-22"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va">ctsmrTMB</span><span class="op">$</span><span class="fu">summary</span><span class="op">(</span>correlation <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>

<div class="section">
<h4 id="arguments-15">Arguments<a class="anchor" aria-label="anchor" href="#arguments-15"></a></h4>
<p></p><div class="arguments"><dl><dt><code>correlation</code></dt>
<dd><p>boolean value. The default (<code>FALSE</code>) is to not provide the fixed effects parameter
correlation matrix.</p></dd>


</dl><p></p></div>
</div>

</div><p></p><hr><a id="method-ctsmrTMB-plot"></a><div class="section">
<h3 id="method-plot-">Method <code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code><a class="anchor" aria-label="anchor" href="#method-plot-"></a></h3>
<p>Function to print the model object</p><div class="section">
<h4 id="usage-23">Usage<a class="anchor" aria-label="anchor" href="#usage-23"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va">ctsmrTMB</span><span class="op">$</span><span class="fu">plot</span><span class="op">(</span></span>
<span>  plot.obs <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  use.ggplot <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  extended <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  ggtheme <span class="op">=</span> <span class="fu">getggplot2theme</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>

<div class="section">
<h4 id="arguments-16">Arguments<a class="anchor" aria-label="anchor" href="#arguments-16"></a></h4>
<p></p><div class="arguments"><dl><dt><code>plot.obs</code></dt>
<dd><p>integer value. The value determines which state residual plot is shown, when the states are numbered
by the order in which they were defined in the model object.</p></dd>


<dt><code>use.ggplot</code></dt>
<dd><p>boolean value. The default <code>FALSE</code> is to use base plots in R, if <code>TRUE</code> then <code>ggplot2</code>
is used to show and return a list of all residual state plots.</p></dd>


<dt><code>extended</code></dt>
<dd><p>boolean value. No functionality yet.</p></dd>


<dt><code>ggtheme</code></dt>
<dd><p>ggplot theme. This determines the theme used to construct the ggplot2 if <code>use.ggplot=TRUE</code>.</p></dd>


</dl><p></p></div>
</div>

</div><p></p><hr><a id="method-ctsmrTMB-clone"></a><div class="section">
<h3 id="method-clone-">Method <code>clone()</code><a class="anchor" aria-label="anchor" href="#method-clone-"></a></h3>
<p>The objects of this class are cloneable with this method.</p><div class="section">
<h4 id="usage-24">Usage<a class="anchor" aria-label="anchor" href="#usage-24"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va">ctsmrTMB</span><span class="op">$</span><span class="fu">clone</span><span class="op">(</span>deep <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>

<div class="section">
<h4 id="arguments-17">Arguments<a class="anchor" aria-label="anchor" href="#arguments-17"></a></h4>
<p></p><div class="arguments"><dl><dt><code>deep</code></dt>
<dd><p>Whether to make a deep clone.</p></dd>


</dl><p></p></div>
</div>

</div>

    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by Phillip Vetter.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer></div>

  

  

  </body></html>

